---
title: "exeファイルでのゲームについて"
tags:
  - zakkan
  - tech
date: "2025-11-02"
---

### Contents{: .toc-heading}


### 転換
僕が作るゲームの多くはWebサイトの形で作ってきた。僕は[前回も述べたように](https://coiluck.moe/blog/reason_to_walk/){: .blog-link}Web先にサイトを作っており、その後から同じ技術（HTML + JavaScript）でゲームを作成してGitHub PagesでWebサイトとして公開していた。しかし、この方針を取りやめ、Electronを用いて`.exe`ファイルで作成することにした。<br>
Electronというのは、HTML・CSS・JavaScriptで作ったWebアプリを、ChromiumとNode.jsを内包したデスクトップアプリとして動かせる仕組みだ。Windows向けには`.exe`ファイルとして出力できる。Chromiumを同梱するためサイズはやや大きくなるが、JavaScriptしか書けない僕にとっては嬉しい選択肢だった。<br><br>

### 理由1: ページのサイズを気にしてしまう
既存のゲームは、ページにアクセスした時に多くのファイルが読み込まれる。画像要素は非表示にしていてもHTMLに存在するならファイル読み込みが発生するという仕様がある。ゲーム画面では見えないようになっているだけで、多くの画面を（非表示状態で）用意している作り方だと、初回読み込み時にいくらか時間がかかってしまう[^1]。これを改善するためにすべての`.png`ファイルを`.avif`ファイルに変換するのだが、手間がかかるし後から編集できないため不便だ。<br><br>

### 理由2: Webだと不便なことがある
Webサイトの形だと出来なくて、同じ技術のElectronだと出来ることがある。<br>
まず1つは、データの保存だ。既存のゲームでも途中からゲームを始めたり、実績を解除したりすることが出来た。これらのデータはユーザーの使用しているブラウザの`localStorage`に保存していた。しかし、`localStorage`に保存したデータは数週間程度で消えてしまう場合がある[^2]。Electronを使ってユーザーのアプリとしてインストールさせれば、ローカルにデータを保存出来る。<br>
2つ目は音楽の再生だ。Webサイトだとユーザーがアクションを起こすまで、音楽を再生できないという制約がある。そのためこれまでのゲームのトップページにサウンドはないのだが、これもアプリにすれば無効化できる。<br>
それから、スマホで見られないという利点がある。これは欠点ではなく利点なのだ。今までのゲームの大半はスマホユーザーのためにデザインをレスポンシブにしていたが、これはかなり面倒だった。ゲームは同じ画面に多くの要素を詰め込むし、場合によっては要素の順も変えなければいけない。どのサイズでも正しく見えるようにブラウザのサイズを変えながら各要素をチェックする必要がないのは嬉しい。<br><br>

### 理由3: 他のサービスで配布できない
一部のプラットフォーム（例: Steamなど）ではWebアプリ形式のゲームを直接配布できず、実行ファイル形式にする必要がある。<br><br>

### 今までとの違い
`localStrage`にデータを保存・読み込みする部分は（Windowsなら）`C:\Users\${username}\AppData\Roaming`に保存する為に少しだけ書き換える必要があるが、言語が同じであるため、ほぼ全て既存のコードを流用できる。<br>
僕はelectron-storeというライブラリを使用してデータを保存している。
```js
// main.js
// メインプロセス
const Store = require('electron-store');

const store = new Store({
  schema: {
    'lang': {
      type: 'string',
      enum: ['en', 'ja'],
      default: 'ja'
    },
    'gameData': {
      type: ['object', 'null'],
      default: null
    }
  }
});

function saveGameData(gameState) {
  try {
    store.set('gameData', gameState);
    return true;
  } catch (e) {
    return false;
  }
}

function getGameData() {
  return store.get('gameData');
}

function deleteGameData() {
  store.delete('gameData');
}
```
最初に形を宣言すれば、`set`、`get`、`delete`で簡単にデータを保存・読み込み・削除できる[^3]。
[^1]: タイトル文字・ボタンをフェードインするようにするとこの不快感が軽減されると思う。[例はこれ](https://coiluck.moe/SinkendenSonne){: .blog-link}
[^2]: localStorageは明示的に消すor容量が最大（全サイトで5MB）になる以外の場合ではデータは保持されるはずなのだが、自分のブラウザでは削除されてしまうようだ。Safariの場合も数週間で削除されるので、あまりlocalStorageは信用していない。
[^3]: これはelectron-storeのバージョン7までしかできない。